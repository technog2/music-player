import{d as P,u as E,r as y,c as U,a as j,b as g,t as w,o as h,w as A,e as B,f as I,g as u,h as T,v as $,i as N,j as V,F as q,k as L}from"./index-DFJhN67m.js";function D(l){async function t(s,n,r,e){var _,k;(_=e==null?void 0:e.loading)==null||_.split(":")[0],(k=e==null?void 0:e.loading)==null||k.split(":")[1],e!=null&&e.loadingVar&&(e.loadingVar.value=!0);try{let v=`http://localhost:4000/v1${n}`;if(e!=null&&e.query){const c=Object.entries(e.query).map(p=>p.join("=")).join("&");c&&(v+=`?${c}`)}const b=await fetch(v,{method:s,body:r?JSON.stringify(r):null,headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("access-token")}`}}),a=await b.json();return e!=null&&e.var&&(e.var.value=a),{ok:b.ok,data:a}}catch(v){return console.error(v),{ok:!1,data:v}}finally{e!=null&&e.loadingVar&&(e.loadingVar.value=!1)}}return{get:async(s,n)=>t("GET",s,null,n),post:async(s,n,r)=>t("POST",s,n,r),put:async(s,n,r)=>t("PUT",s,n,r),patch:async(s,n,r)=>t("PATCH",s,n,r),delete:async(s,n,r)=>t("DELETE",s,n,r)}}const O=()=>{function l(t){var o;(o=document.getElementById(t))==null||o.focus()}return{focus:l}};class x extends Error{}x.prototype.name="InvalidTokenError";function M(l){return decodeURIComponent(atob(l).replace(/(.)/g,(t,o)=>{let i=o.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function F(l){let t=l.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return M(t)}catch{return atob(t)}}function J(l,t){if(typeof l!="string")throw new x("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,i=l.split(".")[o];if(typeof i!="string")throw new x(`Invalid token specified: missing part #${o+1}`);let m;try{m=F(i)}catch(d){throw new x(`Invalid token specified: invalid base64 for part #${o+1} (${d.message})`)}try{return JSON.parse(m)}catch(d){throw new x(`Invalid token specified: invalid json for part #${o+1} (${d.message})`)}}const K=P("Auth",()=>{const l=E(),t=D(),o=y(),i=U(()=>{var n;return o.value?J((n=o.value)==null?void 0:n.accessToken):null});function m(n){o.value=n,sessionStorage.setItem("access-token",n.accessToken),sessionStorage.setItem("refresh-token",n.refreshToken)}function d(){o.value={accessToken:sessionStorage.getItem("access-token"),refreshToken:sessionStorage.getItem("refresh-token")}}function f(){var n,r;sessionStorage.getItem("access-token")&&sessionStorage.getItem("refresh-token")?(d(),(n=i.value)!=null&&n.exp&&((r=i.value)==null?void 0:r.exp)*1e3<Date.now()&&s()):s()}async function s(){await t.post("/auth/logout",{}),o.value=null,sessionStorage.removeItem("access-token"),sessionStorage.removeItem("refresh-token"),l.push("/login")}return{token:o,user:i,setToken:m,checkAuth:f,logout:s}}),R={type:"submit",class:"w-full bg-rose-900 rounded-xl px-4 py-2 outline-none text-center mt-2"},z={key:0,class:"loading loading-spinner"},G={key:1},C=j({__name:"SimpleButton",props:{value:{},loading:{type:Boolean}},setup(l){return(t,o)=>(h(),g("button",R,[t.loading?(h(),g("span",z)):(h(),g("span",G,w(t.value),1))]))}}),H={class:"bg-[url('/src/assets/images/bg.png')] bg-no-repeat bg-center bg-cover"},Q={class:"pt-20 px-10"},W={key:0,class:"text-error text-sm mt-2 transition"},X={class:"text-center px-14 pt-28"},Y={class:"text-gray-300 mt-4"},Z={class:"pt-20 px-10"},ee={class:"flex gap-2 mt-2",dir:"ltr"},te=["onUpdate:modelValue","onKeyup","id"],oe=j({__name:"Login",setup(l){const t=E(),o=D(),i=O(),m=K(),d=y(0),f=y(""),s=y(),n=y([]),r=y(!1),e=y();A(f,a=>/^09\d{9}$/.test(a)?e.value=null:e.value="Cellphone number is not valid."),B(()=>{b(),i.focus("phone-input")});async function _(){try{const a=await o.post("/auth/verification",{cellphone:f.value},{loadingVar:r});a.ok&&(s.value=a.data.verificationId,d.value++,await b(),i.focus("index-1"))}catch(a){console.error(a)}}async function k(){try{const a=await o.post("/auth/login",{code:n.value.join(""),verificationId:s.value},{loadingVar:r});a.ok&&(m.setToken(a.data),t.push("/"))}catch(a){console.error(a)}}async function v(a){a===5?await k():i.focus(`index-${a+1}`)}function b(a=500){return new Promise(c=>setTimeout(c,a))}return(a,c)=>(h(),g("div",H,[d.value===0?(h(),g("form",{key:0,onSubmit:I(_,["prevent"]),class:""},[c[1]||(c[1]=u("div",{class:"text-center px-14 pt-28"},[u("h2",{class:"text-white font-bold text-3xl"},"Cellphone"),u("p",{class:"text-gray-300 mt-4"},"Please perform your country code and enter your cellphone number.")],-1)),u("div",Q,[T(u("input",{"onUpdate:modelValue":c[0]||(c[0]=p=>f.value=p),type:"text",id:"phone-input",placeholder:"Phone number",class:"w-full bg-transparent border-[1.5px] border-gray-700 rounded-xl px-4 py-2 outline-none",required:""},null,512),[[$,f.value]]),e.value?(h(),g("span",W,w(e.value),1)):N("",!0),V(C,{loading:r.value,value:"Continue"},null,8,["loading"])])],32)):(h(),g("form",{key:1,onSubmit:I(k,["prevent"]),class:""},[u("div",X,[c[2]||(c[2]=u("h2",{class:"text-white font-bold text-3xl"},"Perform",-1)),u("p",Y,'Enter the validation code sent to the phone number "'+w(f.value)+'"',1)]),u("div",Z,[u("div",ee,[(h(),g(q,null,L(5,p=>T(u("input",{"onUpdate:modelValue":S=>n.value[p]=S,onKeyup:S=>v(p),id:`index-${p}`,type:"text",class:"bg-transparent border-[1.5px] border-gray-700 rounded-xl p-2 w-full text-center outline-none",maxlength:"1",required:""},null,40,te),[[$,n.value[p]]])),64))]),V(C,{loading:r.value,value:"Login",class:"mt-4"},null,8,["loading"])])],32))]))}});export{oe as default};
